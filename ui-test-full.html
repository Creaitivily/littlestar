<!DOCTYPE html>
<html>
<head>
    <title>Test Content System</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .topic { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .loading { background: #fff3cd; }
        h2 { color: #333; }
        .article { margin: 5px 0; padding: 5px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Testing Content System</h1>
    <div id="results"></div>

    <script>
        const supabaseUrl = 'https://ctiewkuervrxlajpjaaz.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0aWV3a3VlcnZyeGxhanBqYWF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1NTQxNjQsImV4cCI6MjA3MTEzMDE2NH0.av5CL8gcxL79C2zCxMSi4icCTAA6de2Cu81g5M7tzRo';
        
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);
        
        const topics = [
            { id: 'feeding_nutrition', name: 'Feeding & Nutrition' },
            { id: 'sleep_patterns', name: 'Sleep & Rest' },
            { id: 'cognitive_development', name: 'Learning & Development' },
            { id: 'physical_development', name: 'Physical Growth' },
            { id: 'social_emotional', name: 'Social & Emotional' },
            { id: 'health_safety', name: 'Health & Safety' }
        ];
        
        const resultsDiv = document.getElementById('results');
        
        async function testTopic(topic) {
            const topicDiv = document.createElement('div');
            topicDiv.className = 'topic loading';
            topicDiv.innerHTML = `<h2>${topic.name} (${topic.id})</h2><p>Loading...</p>`;
            resultsDiv.appendChild(topicDiv);
            
            try {
                // Simulate exact query from ContentCurationSystem
                const { data, error } = await supabase
                    .from('fresh_topic_content')
                    .select('*')
                    .eq('topic', topic.id)
                    .gte('quality_score', 0.3)
                    .order('quality_score', { ascending: false })
                    .order('publication_date', { ascending: false })
                    .limit(12);
                
                if (error) {
                    topicDiv.className = 'topic error';
                    topicDiv.innerHTML = `<h2>${topic.name}</h2><p>Error: ${error.message}</p>`;
                } else if (!data || data.length === 0) {
                    topicDiv.className = 'topic error';
                    topicDiv.innerHTML = `<h2>${topic.name}</h2><p>❌ No articles found!</p>`;
                } else {
                    topicDiv.className = 'topic success';
                    let html = `<h2>${topic.name}</h2>`;
                    html += `<p>✅ Found ${data.length} articles</p>`;
                    html += '<div style="max-height: 200px; overflow-y: auto;">';
                    data.forEach((article, idx) => {
                        html += `<div class="article">${idx + 1}. ${article.title.substring(0, 60)}... (Score: ${article.quality_score.toFixed(2)})</div>`;
                    });
                    html += '</div>';
                    topicDiv.innerHTML = html;
                }
            } catch (err) {
                topicDiv.className = 'topic error';
                topicDiv.innerHTML = `<h2>${topic.name}</h2><p>Error: ${err.message}</p>`;
            }
        }
        
        // Test all topics
        async function runTests() {
            resultsDiv.innerHTML = '<p>Testing all topics...</p>';
            
            for (const topic of topics) {
                await testTopic(topic);
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            resultsDiv.innerHTML += '<h2 style="color: green;">✅ All tests complete!</h2>';
        }
        
        runTests();
    </script>
</body>
</html>